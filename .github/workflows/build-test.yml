name: Build MomCare App

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Xcode
      run: |
        sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
        sudo xcodebuild -runFirstLaunch

    - name: Install required simulator
      run: |
        xcrun simctl list devices
        sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer
        sudo xcrun simctl create "iPhone 14" com.apple.CoreSimulator.SimDeviceType.iPhone-14 com.apple.CoreSimulator.SimRuntime.iOS-16-2
        xcrun simctl boot "iPhone 14"

    - name: Build and test MomCare app
      run: |
        xcodebuild -project MomCare.xcodeproj \
          -scheme MomCare \
          -sdk iphonesimulator \
          -destination 'platform=iOS Simulator,name=iPhone 14,OS=16.2' \
          clean build
      env:
        DEVELOPER_DIR: /Applications/Xcode.app/Contents/Developer
